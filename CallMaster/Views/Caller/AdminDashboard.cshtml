@model CallMaster.Models.AdminSharedView
@using CallMaster.Models.CallMaster.Models
@using CallMaster.Models


<div class="container-fluid">
    <div class="row flex-nowrap">
        <!-- Sidebar - Updated: Removed hardcoded 'active' class -->
        <div class="col-auto px-0">
            <div id="sidebar" class="sidebar collapse-horizontal expandable">
                <div class="sidebar-header">
                    <button class="expand-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link" data-bs-toggle="tab">
                            <i class="fas fa-chart-pie"></i>
                            <span class="link-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#userManagement" class="nav-link" data-bs-toggle="tab">
                            <i class="fas fa-users-cog"></i>
                            <span class="link-text">User Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#campaigns" class="nav-link" data-bs-toggle="tab">
                            <i class="fas fa-project-diagram"></i>
                            <span class="link-text">Campaign Oversight</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#auditLogs" class="nav-link" data-bs-toggle="tab">
                            <i class="fas fa-clipboard-list"></i>
                            <span class="link-text">Audit Logs</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#teamManagement" class="nav-link" data-bs-toggle="tab">
                            <i class="fas fa-users-between-lines"></i>
                            <span class="link-text">Team Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#licenseManagement" class="nav-link" data-bs-toggle="tab">
                            <i class="fas fa-key"></i>
                            <span class="link-text">License Management</span>
                        </a>
                    </li>

                </ul>
            </div>
        </div>

       


        <!-- Main Content -->
        <div class="col p-4">
            <!-- Add this right after the <div class="col p-4"> -->
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    @TempData["Error"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    @TempData["Success"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Welcome, <span class="text-primary">@Model.DashboardData.AdminName</span></h2>
                <div class="alert alert-warning mb-0">
                    <i class="fas fa-exclamation-circle"></i>
                    System Health: <span class="text-success">All Systems Operational</span>
                </div>
            </div>

            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div class="tab-pane fade" id="dashboard">
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card bg-primary text-white">
                                <div class="card-body">
                                    <h5><i class="fas fa-users"></i> Total Users</h5>
                                    <h2>@(Model.DashboardData.TotalAgents + Model.DashboardData.TotalManagers)</h2>
                                    <small>@Model.DashboardData.TotalManagers Managers, @Model.DashboardData.TotalAgents Agents</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card bg-success text-white">
                                <div class="card-body">
                                    <h5><i class="fas fa-bullhorn"></i> Active Campaigns</h5>
                                    <h2>@Model.DashboardData.TotalActiveCampaigns</h2>
                                    <small>Placeholder</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card bg-info text-white">
                                <div class="card-body">
                                    <h5><i class="fas fa-phone-volume"></i> Daily Calls</h5>
                                    <h2>@Model.DashboardData.DailyCalls</h2>
                                    <small>@Model.DashboardData.DailyIncreasedCallsPersent% from yesterday</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card bg-warning text-dark">
                                <div class="card-body">
                                    <h5><i class="fas fa-exclamation-triangle"></i> Issues</h5>
                                    <h2>3</h2>
                                    <small>2 Unresolved tickets</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card shadow mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">User Activity Heatmap</h5>
                                </div>
                                <div class="card-body">
                                    <!-- Add heatmap visualization -->
                                    <div class="heatmap-placeholder" style="height: 200px"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0">Role Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-pie">
                                        <!-- Add pie chart -->
                                        <canvas id="roleDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- User Management Tab -->
                <div class="tab-pane fade" id="userManagement">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">User Management</h5>
                            <div>
                                <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#createUserModal">
                                    <i class="fas fa-user-plus"></i> Create User
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Filter Form -->
                            <form method="get" action="@Url.Action("AdminDashboard")#userManagement">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="Search users..."
                                               name="searchName" value="@ViewBag.SearchName">
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" name="roleFilter">
                                            <option value="">All Roles</option>
                                            <option value="Admin" selected="@(ViewBag.RoleFilter == "Admin")">Admin</option>
                                            <option value="Manager" selected="@(ViewBag.RoleFilter == "Manager")">Manager</option>
                                            <option value="Agent" selected="@(ViewBag.RoleFilter == "Agent")">Agent</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" name="statusFilter">
                                            <option value="">All Statuses</option>
                                            <option value="Active" selected="@(ViewBag.StatusFilter == "Active")">Active</option>
                                            <option value="Inactive" selected="@(ViewBag.StatusFilter == "Inactive")">Inactive</option>
                                            <option value="Suspended" selected="@(ViewBag.StatusFilter == "Suspended")">Suspended</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="fas fa-filter"></i> Filter
                                        </button>
                                    </div>
                                </div>
                            </form>

                            <!-- User Table -->
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Full Name</th>
                                            <th>Role</th>
                                            <th>Last Login</th>
                                            <th>Status</th>
                                            <th>Manager</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var user in Model.UsersData)
                                        {
                                            <tr>
                                                <td>@user.FullName</td>
                                                <td>@user.Role</td>
                                                <td>@user.LastLogin</td>
                                                <td>
                                                    @{
                                                        var statusClass = user.Status switch
                                                        {
                                                            "Active" => "bg-success",
                                                            "Inactive" => "bg-warning",
                                                            "Suspended" => "bg-danger",
                                                            _ => "bg-secondary"
                                                        };
                                                    }
                                                    <span class="badge @statusClass">@user.Status</span>
                                                </td>
                                                <td>@user.ManagerName</td>
                                                <td>
                                                    <form asp-action="ToggleUserStatus" method="post" class="d-inline">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="userId" value="@user.Id" />
                                                        <input type="hidden" name="status" value="@(user.Status == "Active" ? "Inactive" : "Active")" />
                                                        <button type="submit" class="btn btn-sm @(user.Status == "Active" ? "btn-outline-warning" : "btn-outline-success")">
                                                            <i class="fas @(user.Status == "Active" ? "fa-toggle-off" : "fa-toggle-on") me-1"></i>
                                                            @(user.Status == "Active" ? "Deactivate" : "Activate")
                                                        </button>
                                                    </form>

                                                    <button class="btn btn-sm btn-outline-secondary ms-1"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#editUserModal"
                                                            data-userid="@user.Id"
                                                            data-fullname="@user.FullName"
                                                            data-email="@user.Email"
                                                            data-role="@user.Role"
                                                            data-teamid="@user.TeamId">
                                                        <i class="fas fa-edit me-1"></i> Edit
                                                    </button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination -->
                            <nav aria-label="User pagination">
                                <ul class="pagination justify-content-end">
                                    @if (ViewBag.CurrentPage > 1)
                                    {
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="@Url.Action("AdminDashboard", new {
                                   page = 1,
                                   searchName = ViewBag.SearchName,
                                   roleFilter = ViewBag.RoleFilter,
                                   statusFilter = ViewBag.StatusFilter
                               })#userManagement">First</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="@Url.Action("AdminDashboard", new {
                                   page = ViewBag.CurrentPage - 1,
                                   searchName = ViewBag.SearchName,
                                   roleFilter = ViewBag.RoleFilter,
                                   statusFilter = ViewBag.StatusFilter
                               })#userManagement">Previous</a>
                                        </li>
                                    }

                                    @for (var i = 1; i <= ViewBag.TotalPages; i++)
                                    {
                                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                            <a class="page-link"
                                               href="@Url.Action("AdminDashboard", new {
                                   page = i,
                                   searchName = ViewBag.SearchName,
                                   roleFilter = ViewBag.RoleFilter,
                                   statusFilter = ViewBag.StatusFilter
                               })#userManagement">@i</a>
                                        </li>
                                    }

                                    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                                    {
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="@Url.Action("AdminDashboard", new {
                                   page = ViewBag.CurrentPage + 1,
                                   searchName = ViewBag.SearchName,
                                   roleFilter = ViewBag.RoleFilter,
                                   statusFilter = ViewBag.StatusFilter
                               })#userManagement">Next</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="@Url.Action("AdminDashboard", new {
                                   page = ViewBag.TotalPages,
                                   searchName = ViewBag.SearchName,
                                   roleFilter = ViewBag.RoleFilter,
                                   statusFilter = ViewBag.StatusFilter
                               })#userManagement">Last</a>
                                        </li>
                                    }
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        // Function to activate correct tab
                        const activateTab = () => {
                            const hash = window.location.hash;
                            if (hash) {
                                // Find the nav link corresponding to the hash
                                const trigger = document.querySelector(`a[href="${hash}"][data-bs-toggle="tab"]`);
                                if (trigger) {
                                    // Bootstrap's tab activation method
                                    new bootstrap.Tab(trigger).show();

                                    // Add active class to nav link
                                    trigger.classList.add('active');

                                    // Add show active to target pane
                                    const targetPane = document.querySelector(hash);
                                    if (targetPane) {
                                        targetPane.classList.add('show', 'active');
                                    }
                                }
                            } else {
                                // Default to dashboard if no hash
                                const defaultTab = document.querySelector('[href="#dashboard"]');
                                new bootstrap.Tab(defaultTab).show();
                                defaultTab.classList.add('active');
                                document.querySelector('#dashboard').classList.add('show', 'active');
                            }
                        };

                        // Initial activation
                        activateTab();

                        // Handle hash changes (browser navigation)
                        window.addEventListener('hashchange', activateTab);

                        // Update URL when manually clicking tabs
                        document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
                            tab.addEventListener('click', function(e) {
                                window.location.hash = this.getAttribute('href');
                            });
                        });
                    });
                </script>


                <!-- Create User Modal -->
                <div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="createUserModalLabel">Create New User</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form method="post" asp-action="CreateUser">
                                    <input type="hidden" name="page" value="@ViewBag.CurrentPage" />
                                    <input type="hidden" name="searchName" value="@ViewBag.SearchName" />
                                    <input type="hidden" name="roleFilter" value="@ViewBag.RoleFilter" />
                                    <input type="hidden" name="statusFilter" value="@ViewBag.StatusFilter" />

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">First Name</label>
                                                <input type="text" class="form-control" name="firstName" required />
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Last Name</label>
                                                <input type="text" class="form-control" name="surname" required />
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" name="email" required />
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Password</label>
                                                <input type="password" class="form-control" name="password" required />
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" name="phoneNumber" required />
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">License Key</label>
                                                <select class="form-select" name="licenseKey" required>
                                                    @foreach (var license in Model.Licenses.Where(l => l.Status == "Active" && l.UsuableAcounts > 0))
                                                    {
                                                        <option value="@license.Key">@license.Key (@license.Role - @license.UsuableAcounts uses left)</option>
                                                    }
                                                </select>
                                                @if (!Model.Licenses.Any(l => l.Status == "Active" && l.UsuableAcounts > 0))
                                                {
                                                    <div class="text-danger mt-2">No available licenses</div>
                                                }
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Team</label>
                                                <select class="form-select" name="teamId" required>
                                                    @foreach (var team in Model.Teams)
                                                    {
                                                        <option value="@team.Id">@team.Name</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Create User</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Edit User Modal -->
                <div class="modal fade" id="editUserModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Edit User</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editUserForm" method="post" asp-action="EditUser">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="userId" id="editUserId" />

                                    <div class="mb-3">
                                        <label for="editFullName" class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="editFullName" name="fullName" required />
                                    </div>
                                    <div class="mb-3">
                                        <label for="editEmail" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="editEmail" name="email" required />
                                    </div>
                                    <div class="mb-3">
                                        <label for="editRole" class="form-label">Role</label>
                                        <select class="form-select" id="editRole" name="role" required>
                                            <option value="Admin">Admin</option>
                                            <option value="Manager">Manager</option>
                                            <option value="Agent">Agent</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Team</label>
                                        <select class="form-select" name="teamId">
                                            <option value="">No Team</option>
                                            @foreach (var team in Model.Teams)
                                            {
                                                <option value="@team.Id">@team.Name</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>


                <script>
                                          document.addEventListener('DOMContentLoaded', function() {
                        document.querySelectorAll('[data-bs-target="#editUserModal"]').forEach(button => {
                            button.addEventListener('click', function() {
                                const userId = this.getAttribute('data-userid');
                                const fullName = this.getAttribute('data-fullname');
                                const email = this.getAttribute('data-email');
                                const role = this.getAttribute('data-role');
                                const teamId = this.getAttribute('data-teamid');

                                // Populate modal fields
                                document.getElementById('editUserId').value = userId;
                                document.getElementById('editFullName').value = fullName;
                                document.getElementById('editEmail').value = email;
                                document.getElementById('editRole').value = role;
                                document.querySelector('[name="teamId"]').value = teamId || '';
                            });
                        });
                    });
                </script>



                <!-- Campaign Oversight Tab -->
                <div class="tab-pane fade" id="campaigns">
                    <div class="card shadow">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Campaign Overview</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="alert alert-primary">
                                        <i class="fas fa-chart-line me-2"></i>
                                        Total Campaigns: @Model.Campaigns.Count()
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        Active Campaigns: @Model.Campaigns.Count(c => c.Status == CampaignStatus.Active)
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="alert alert-warning">
                                        <i class="fas fa-pause-circle me-2"></i>
                                        Inactive Campaigns: @Model.Campaigns.Count(c => c.Status != CampaignStatus.Active)
                                    </div>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Campaign</th>
                                            <th>Status</th>
                                            <th>Agents</th>
                                            <th>Total Calls</th>
                                            <th>Completed</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var campaign in Model.Campaigns)
                                        {
                                            var completedCalls = campaign.PhoneNumbers.Count(p => p.Outcome == CallOutcome.Completed);
                                            var totalCalls = campaign.PhoneNumbers.Count;
                                            var progress = totalCalls > 0 ? (completedCalls * 100) / totalCalls : 0;

                                            <tr>
                                                <td>@campaign.Name</td>
                                                <td>
                                                    <span class="badge @GetStatusBadge(campaign.Status)">
                                                        @campaign.Status
                                                    </span>
                                                </td>
                                                <td>@campaign.AssignedAgents.Count</td>
                                                <td>@totalCalls</td>
                                                <td>@completedCalls</td>
                                                <td>
                                                    <div class="progress" style="height: 20px;">
                                                        <div class="progress-bar bg-success"
                                                             role="progressbar"
                                                             style="width: @progress%"
                                                             aria-valuenow="@progress"
                                                             aria-valuemin="0"
                                                             aria-valuemax="100">
                                                            @progress%
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>@campaign.CreatedAt.ToString("dd MMM yyyy")</td>
                                            </tr>
                                        }
                                        @if (!Model.Campaigns.Any())
                                        {
                                            <tr>
                                                <td colspan="7" class="text-center text-muted py-4">
                                                    No campaigns found
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                @functions {
                    string GetStatusBadge(CampaignStatus status)
                    {
                        return status switch
                        {
                            CampaignStatus.Active => "bg-success",
                            CampaignStatus.Completed => "bg-primary",
                            CampaignStatus.Paused => "bg-danger",
                            _ => "bg-secondary"
                        };
                    }
                }
                <!-- Audit Logs Tab -->
                <div class="tab-pane fade" id="auditLogs">
                    <div class="card shadow">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0">System Audit Logs</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Timestamp</th>
                                            <th>User</th>
                                            <th>Action</th>
                                            <th>Details</th>
                                            <th>IP Address</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Audit log entries -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Management Tab -->
                <div class="tab-pane fade" id="teamManagement">
                    <div class="card shadow">
                        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Team Management</h5>
                            <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#createTeamModal">
                                <i class="fas fa-plus"></i> Create Team
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Team Name</th>
                                            <th>Member Count</th>
                                            <th>Managers</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var team in Model.Teams)
                                        {
                                            <tr>
                                                <td>@team.Name</td>
                                                <td>@team.Users.Count</td>
                                                <td>
                                                    @string.Join(", ", team.Users.Where(u => u.Role == "Manager").Select(u => $"{u.pName} {u.Surname}"))
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-danger"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#deleteTeamModal"
                                                            data-teamid="@team.Id"
                                                            data-teamname="@team.Name">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Licence Management Tab -->
                <div class="tab-pane fade" id="licenseManagement">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">License Management</h5>
                            <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#createLicenseModal">
                                <i class="fas fa-plus"></i> Generate License
                            </button>
                        </div>
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Key</th>
                                        <th>Role</th>
                                        <th>Expires</th>
                                        <th>Remaining</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var license in Model.Licenses)
                                    {
                                        <tr>
                                            <td>@license.Key</td>
                                            <td>@license.Role</td>
                                            <td>@license.ExpiresAt.ToShortDateString()</td>
                                            <td>@license.UsuableAcounts</td>
                                            <td><span class="badge bg-success">@license.Status</span></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    

    <!-- Generate License Modal -->
    <div class="modal fade" id="createLicenseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Generate License</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="post" asp-action="GenerateLicense">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label>Role</label>
                            <select class="form-select" name="role" required>
                                <option value="Admin">Admin</option>
                                <option value="Manager">Manager</option>
                                <option value="Agent">Agent</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label>Expiration Date</label>
                            <input type="date" class="form-control" name="expiresAt" required />
                        </div>
                        <div class="mb-3">
                            <label>Activations</label>
                            <input type="number" class="form-control" name="usableAccounts" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Generate</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    

    <!-- Create Team Modal -->
    <div class="modal fade" id="createTeamModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form asp-action="CreateTeam" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Team Name</label>
                            <input type="text" class="form-control" name="teamName" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Create Team</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Team Modal -->
    <div class="modal fade" id="deleteTeamModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Team</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form asp-action="DeleteTeam" method="post">
                    <div class="modal-body">
                        <p>Are you sure you want to delete team <strong id="teamNameLabel"></strong>?</p>
                        <input type="hidden" name="teamId" id="deleteTeamId">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-danger">Confirm Delete</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Delete Team Modal Handler
            document.querySelectorAll('[data-bs-target="#deleteTeamModal"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('deleteTeamId').value = this.dataset.teamid;
                    document.getElementById('teamNameLabel').textContent = this.dataset.teamname;
                });
            });
        });
    </script>
</div>